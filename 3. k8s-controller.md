# 0ï¸âƒ£ì›Œí¬ë¡œë“œ

**ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜, ì„œë¹„ìŠ¤ ë°°í¬ì˜ ë‹¨ìœ„**

- ì›Œí¬ë¡œë“œ ê´€ë¦¬ ë¦¬ì†ŒìŠ¤ë¥¼ í†µí•´ ì‚¬ìš©ì ìš”êµ¬ ì‚¬í•­(ë°°í¬, ìš´ì˜, í™•ì¥) ìˆ˜í–‰ ê°€ëŠ¥
    - ReplicaSet, Deployment, StatefulSet ë“±
- YAML ë“±ì˜ íŒŒì¼ í˜•ì‹ì„ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìˆ˜ëª…ì£¼ê¸°ë¥¼ ì„ ì–¸ì  ë°©ì‹ìœ¼ë¡œ ê´€ë¦¬ ê°€ëŠ¥

![](https://velog.velcdn.com/images/alstjr971/post/4e760497-366c-4723-be8b-f9ca7f6a0b72/image.png)

* Deploymentë¥¼ ì„ ì–¸ì  ë°©ì‹ìœ¼ë¡œ ì‘ì„±í•œ ì˜ˆ

```yaml
apiVersion: apps/v1beta1
kind: Deployment
metadata:
	name: nginx-deployment
spec:
	replicas: 2
	template:
		metadata:
			labels:
				app: demo-app
		spec:
			containers:
			- name: hello-world
				image: hello-world:latest
				ports:
				- containerPort: 80
```

---

# 1ï¸âƒ£ ReplicaSet

- `Downtime`ì´ ì—†ëŠ” ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ë¥¼ ìœ„í•´ ë™ì‹œ êµ¬ë™ë˜ëŠ” íŒŒë“œë“¤ì˜ ì§‘í•©ì„ ê´€ë¦¬
- ë ˆí”Œë¦¬ì¹´ êµ¬ì„±ì„ ê°–ì¶˜ íŒŒë“œë“¤ì˜ ë°°í¬ ê·œê²©ì— ì •ì˜ëœ ìˆ˜ ë§Œí¼ì˜ íŒŒë“œì˜ ì •ìƒì ì¸ êµ¬ë™ì„ ë³´ì¥
    - ëŒ€ìƒ íŒŒë“œ ì¤‘ í•˜ë‚˜ê°€ ì˜¤ë¥˜ë¡œ ì¸í•´ ì •ì§€ë˜ë©´, ë™ì¼í•œ ìŠ¤í™ì˜ ìƒˆ íŒŒë“œë¥¼ ì¦‰ì‹œ ë‹¤ì‹œ ë°°í¬

>ğŸ’¡ì¦‰, ë ˆí”Œë¦¬ì¹´ ì…‹ì€ ë™ì¼í•œ ìŠ¤í™ê³¼ ê·œê²©ì„ ê°€ì§„ ë³µì œë³¸ íŒŒë“œë¥¼ ê°€ì§€ê³ , íŒŒë“œ ë‹¤ìš´ ì‹œ ë°”ë¡œ ë³µì œë³¸ìœ¼ë¡œ ëŒ€ì²´í•˜ëŠ” ë¦¬ì†ŒìŠ¤ë‹¤.

![](https://velog.velcdn.com/images/alstjr971/post/bfbca22f-0709-46e8-937c-66b928fa251a/image.png)


- ë ˆí”Œë¦¬ì¹´ì…‹ ì˜ˆì‹œ
    - `replicaset-example.yaml`
    
    ```yaml
    apiVersion: apps/v1
    kind: ReplicaSet
    metadata:
      name: nginx-replicaset
      labels:
        app: nginx
    spec:
      replicas: 3
      selector:
        matchLabels:
          app: nginx
      template:
        metadata:
          labels:
            app: nginx
        spec:
          containers:
            - name: nginx
              image: nginx:latest
              ports:
                - containerPort: 80
    
    ```
    
    ```bash
    kubectl apply -f replicaset-example.yaml # ë°°í¬
    
    kubectl get replicaset # ì¡°íšŒ
    
    kubectl get pods -l app=nginx # matchLabels ì¡°íšŒ
    
    kubectl delete pod [name] # ì‚­ì œí•˜ë©´ ìƒˆë¡œìš´ Podê°€ ìƒì„±ë˜ì„œ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸ ê°€ëŠ¥
    ```
    

---

# 2ï¸âƒ£ Deployment

- íŒŒë“œì™€ ë ˆí”Œë¦¬ì¹´ì…‹ì— ëŒ€í•œ ì„ ì–¸ì  ì—…ë°ì´íŠ¸ ì œê³µ
- ë¡¤ë§ ì—…ë°ì´íŠ¸ë¥¼ í¬í•¨í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë²„ì „ ë° ë°°í¬ ê´€ë¦¬ì— ì£¼ë¡œ ì‚¬ìš©
    - <span style="color: #3498db;">ë ˆí”Œë¦¬ì¹´ì…‹ì˜ ìƒìœ„ ê°ì²´</span>ë¡œ, ì• í”Œë¦¬ì¼€ì´ì…˜ ë° ì„œë¹„ìŠ¤ ë‹¨ìœ„ ê´€ë¦¬ë¡œ ê°€ì¥ ë§ì´ ì‚¬ìš©

![](https://velog.velcdn.com/images/alstjr971/post/8aaf572c-a715-4ef8-ac4d-ba78e04a1fef/image.png)


- ë””í”Œë¡œì´ë¨¼íŠ¸ ì˜ˆì‹œ
    
    `deployment-example.yaml`
    
    ```yaml
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      name: nginx-deployment
      labels:
        app: nginx
    spec:
      replicas: 3
      selector:
        matchLabels:
          app: nginx
      template:
        metadata:
          labels:
            app: nginx
        spec:
          containers:
            - name: nginx
              image: nginx:1.14.2
              ports:
                - containerPort: 80
    ```
    
    ```yaml
    $ kubectl set image deployment/nginx-deployment nginx=nginx:1.16 # 1.16 ë²„ì „ìœ¼ë¡œ ì¬ë°°í¬
    $ kubectl rollout status deployment/nginx-deployment # ìƒíƒœ í™•ì¸
    $ kubectl get pods -l app=nginx
    $ kubectl describe pods nginx-deployment
    ```
    
- í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ëŠ” 1.14.2 ë¡œ ì²« ë°°í¬ ë˜ì—ˆê³ , ì´ë¥¼ set image ëª…ë ¹ì–´ë¡œ 1.16ìœ¼ë¡œ ë³€ê²½
- rollout status ëª…ë ¹ì–´ë¡œ ë¡¤ë§ ì—…ë°ì´íŠ¸ ìƒíƒœë¥¼ í™•ì¸í•œ í›„, describe ëª…ë ¹ì–´ë¡œ íŒŒë“œ ë‚´ë¶€ ì´ë¯¸ì§€ ë²„ì „ì„ í™•ì¸í•´ë³´ë©´ 1.16ìœ¼ë¡œ ë³€ê²½ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

---

# 3ï¸âƒ£ StatefulSet

- ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ìƒíƒœë¥¼ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ” ë¦¬ì†ŒìŠ¤
- íŒŒë“œ ê³ ìœ ì˜ ì´ë¦„ì„ ê°€ì§€ê³  ìˆœì„œëŒ€ë¡œ ìƒì„±ë˜ë©°, ì¬ì‹œì‘ ì‹œì—ë„ ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ IDë¥¼ ìœ ì§€
- íŒŒë“œì˜ ìˆœì„œì™€ ê³ ìœ ì„± ë³´ì¥ì„ ìœ„í•´ ê° íŒŒë“œì— ì˜êµ¬ ë³¼ë¥¨(PV)ì´ í• ë‹¹
    - íŒŒë“œ ì‚­ì œ ì‹œ, ìƒˆë¡œ ìƒì„±ëœ íŒŒë“œì— í•´ë‹¹ ë³¼ë¥¨ì´ ì¬ í• ë‹¹ë¨
- ìŠ¤í…Œì´íŠ¸í’€ì…‹ ì˜ˆì‹œ
    - `statefulset-example.yaml`
    
    ```yaml
    apiVersion: apps/v1
    kind: StatefulSet
    metadata:
      name: web
    spec:
      selector:
        matchLabels:
          app: nginx
      serviceName: "nginx"
      replicas: 2
      template:
        metadata:
          labels:
            app: nginx
        spec:
          containers:
            - name: nginx
              image: nginx:latest
              ports:
                - containerPort: 80
              volumeMounts:
                - name: www
                  mountPath: /usr/share/nginx/html
      volumeClaimTemplates:
        - metadata:
            name: www
          spec:
            accessModes: [ "ReadWriteOnce" ]
            resources:
              requests:
                storage: 1Gi
    
    ```
    
    - ì„¤ëª…
1. **`apiVersion`**, **`kind`**, **`metadata`**: ê¸°ë³¸ì ì¸ ë¦¬ì†ŒìŠ¤ ì •ì˜ì™€ ì´ë¦„ì„ ì„¤ì •
2. **`selector`**: **`StatefulSet`**ì—ì„œ ê´€ë¦¬í•  Podë¥¼ ì„ íƒí•˜ëŠ” ì¡°ê±´ì„ ì •ì˜ 
    - `app: nginx`ë¼ëŠ” ë ˆì´ë¸”ì„ ê°€ì§„ Podë“¤ì„ ì„ íƒ
3. **`serviceName`**: `StatefulSet`ì— ì˜í•´ ìƒì„±ë˜ëŠ” ì„œë¹„ìŠ¤ì˜ ì´ë¦„ì„ ì •ì˜.
   - `nginx`ë¼ëŠ” ì´ë¦„ì˜ ì„œë¹„ìŠ¤ê°€ ìƒì„±
4. **`replicas`**: ìƒì„±í•  `Pod`ì˜ ìˆ˜ë¥¼ ì •ì˜
   - ì—¬ê¸°ì„œëŠ” 2ê°œì˜ `Pod`ë¥¼ ìƒì„±
5. **`template`**: ì‹¤ì œë¡œ ìƒì„±ë  `Pod`ì˜ í…œí”Œë¦¿ì„ ì •ì˜.
   - ê° `Pod`ëŠ” `nginx:latest` ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ê³ , `containerPort: 80`ì„ ì—´ë©°, `volumeMounts`ë¥¼ í†µí•´ **`www`** ë³¼ë¥¨ì„ `/usr/share/nginx/html`ì— ë§ˆìš´íŠ¸
6. **`volumeClaimTemplates`**: ê° `Pod`ì— ëŒ€í•œ **ë™ì  PVC(PersistentVolumeClaim)**ë¥¼ ìƒì„±
   - ê° `Pod`ëŠ” 1Giì˜ ìŠ¤í† ë¦¬ì§€ë¥¼ ìš”ì²­í•˜ê³ , **`ReadWriteOnce`** ì•¡ì„¸ìŠ¤ ëª¨ë“œë¥¼ ì„¤ì •
    
    ```yaml
    $ vi pv-example.yaml # PersistenceVolume ì •ì˜(ì¶”í›„ ì„¤ëª…)
    $ kubectl apply -f pv-example.yaml 
    $ kubectl get pv 
    $ vi statefulset-example.yaml 
    $ kubectl apply -f statefulset-example.yaml
    ```
    
    - `pv-example.yaml`
    
    ```yaml
    apiVersion: v1
    kind: PersistentVolume
    metadata:
      name: pv-web-0
    spec:
      capacity:
        storage: 1Gi
      accessModes:
        - ReadWriteOnce
      hostPath:
        path: "/tmp/data-web-0"
    ---
    apiVersion: v1
    kind: PersistentVolume
    metadata:
      name: pv-web-1
    spec:
      capacity:
        storage: 1Gi
      accessModes:
        - ReadWriteOnce
      hostPath:
        path: "/tmp/data-web-1"
    ```
    
    - ```kubectl delete pod web-1``` ì‹¤í–‰ í›„ì— `get pvc`ë¥¼ í•´ë³´ë©´ ê·¸ëŒ€ë¡œ ìœ ì§€ ì¤‘ì¸ ê²ƒì„ í™•ì¸ ê°€ëŠ¥

---

# ë°ëª¬ì…‹(DaemonSet)

- ëª¨ë“  ë…¸ë“œ, í˜¹ì€ íŠ¹ì • ë ˆì´ë¸”ì„ ê°€ì§„ ë…¸ë“œì— í•˜ë‚˜ì”© ë™ì¼í•œ íŒŒë“œë¥¼ ë°°í¬ ì§€ì›
- í´ëŸ¬ìŠ¤í„°ì—ì„œ ë…¸ë“œê°€ ì¶”ê°€ë˜ë©´ í•´ë‹¹ ë…¸ë“œì—ë„ ë°ëª¬ì…‹ì— ì •ì˜ëœ íŒŒë“œê°€ ë°°í¬ë¨
    - ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§ ë„êµ¬, ë¡œê·¸ ìˆ˜ì§‘ê¸°, CNI ë“± ê³¼ ê°™ì€ ë„êµ¬ì— ì£¼ë¡œ ì‚¬ìš©
    
![](https://velog.velcdn.com/images/alstjr971/post/68b85634-8a71-4f65-88fe-a3b6e8c6f515/image.png)

    
- ë°ëª¬ì…‹ ì˜ˆì‹œ
    - ë°ëª¬ì…‹ì˜ íŠ¹ì„±ì„ í™•ì¸í•˜ê¸° ìœ„í•´ì„  2ê°œ ì´ìƒì˜ ë…¸ë“œê°€ í•„ìš”
    - `daemonset-example.yaml`
    
    ```yaml
    apiVersion: apps/v1
    kind: DaemonSet
    metadata:
      name: daemonset-example
      namespace: default
    spec:
      selector:
        matchLabels:
          name: daemonset-example
      template:
        metadata:
          labels:
            name: daemonset-example
        spec:
          containers:
            - name: hello
              image: busybox
              command:
                - "/bin/sh"
                - "-c"
                - "while true; do echo DaemonSet running on $(hostname); sleep 10; done"
    
    ```
