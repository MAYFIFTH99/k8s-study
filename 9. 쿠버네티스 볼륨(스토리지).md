# 1ï¸âƒ£ ìŠ¤í† ë¦¬ì§€
**ë°ì´í„°ë¥¼ ì˜êµ¬ í˜¹ì€ ì¼ì‹œì ìœ¼ë¡œ ë³´ê´€í•˜ëŠ” ë¬¼ë¦¬/ë…¼ë¦¬ì  ìì›**

`ì£¼ìš” ì†ì„±`
1. ë‚´êµ¬ì„± : ì¥ì•  ë°œìƒ ì‹œ ë°ì´í„° ë³´ì¡´ ì—¬ë¶€
2. í™•ì¥ì„± : ìš©ëŸ‰ ì¦ê° ê°€ëŠ¥ ì—¬ë¶€
3. ì ‘ê·¼ ë°©ì‹ : ë¸”ë¡ vs íŒŒì¼ vs ê°ì²´

![](https://velog.velcdn.com/images/alstjr971/post/988c48f2-bed2-4c68-a3f9-b77a4eae63e5/image.png)

> ì—¬ê¸°ì„œ ë§í•˜ëŠ” ìŠ¤í† ë¦¬ì§€ëŠ” ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì§ì ‘ ë‹¤ë£¨ëŠ” ë°ì´í„°ê°€ ì•„ë‹ˆë¼, ë°ì´í„°ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ë³´ê´€í•˜ëŠ” ë¬¼ë¦¬/ë…¼ë¦¬ì  ìì›ì„ ì˜ë¯¸í•œë‹¤.
- ex) EBS

---

# 2ï¸âƒ£ ë³¼ë¥¨
ğŸ”¹ íŒŒë“œ ì•ˆì—ì„œ ì»¨í…Œì´ë„ˆë“¤ì´ ì‚¬ìš©í•  ìˆ˜ ì‡ë„ë¡ ë§¤í•‘ë˜ëŠ” `ë§ˆìš´íŠ¸ ì§€ì `
ğŸ”¹ ì»¨í…Œì´ë„ˆ ê²©ë¦¬ ì»¨í…ìŠ¤íŠ¸ ë°–ì˜ ìŠ¤í† ë¦¬ì§€ ê³µê°„

`ì£¼ìš” ì†ì„±`
ğŸ”¸ì»¨í…Œì´ë„ˆ ê°„ ë°ì´í„° ê³µìœ , ì¬ìƒì„± ì‹œ ë°ì´í„° ë³´ì¡´
ğŸ”¸ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤Â·í”„ë¡œë¹„ì €ë‹ê³¼ ë¶„ë¦¬ëœ ì¶”ìƒí™” ê³„ì¸µ

![](https://velog.velcdn.com/images/alstjr971/post/0e4b8c89-766c-4247-8765-3f8b1dccf1fc/image.png)



# 3ï¸âƒ£ ìŠ¤í† ë¦¬ì§€ì™€ ë³¼ë¥¨ì˜ ê´€ê³„(ì¶”ìƒí™”)
- ìˆœì„œë„ : íŒŒë“œ ë³¼ë¥¨ -> PVC -> PV -> ë¬¼ë¦¬ ìŠ¤í† ë¦¬ì§€
- ì»¨í…Œì´ë„ˆ ë‚´ ë³¼ë¥¨ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ `ì²­êµ¬ì„œ(Persistence Volume Claim)`ë¥¼ **'ì¶”ìƒì ìœ¼ë¡œ'** ìš”ì²­
   - ì„ ì–¸ ì‹œ ìš©ëŸ‰, ì ‘ê·¼ ëª¨ë“œ, `StorageClass`ë¥¼ ì§€ì •
- ìš”ì²­ì— ë”°ë¼ ìŠ¤í† ë¦¬ì§€ë¥¼ `PV(Persistence Volume)` í˜•íƒœì˜ ë¦¬ì†ŒìŠ¤ë¡œ ìƒì„± ë° ê´€ë¦¬
   - ì§ì ‘ `PV`ë¥¼ ì •ì˜í•˜ê±°ë‚˜(static), í˜¹ì€ ì»¨íŠ¸ë¡¤ëŸ¬ì— ì˜í•´ ìë™ìœ¼ë¡œ PVë¥¼ ìƒì„±í•´ ë°”ì¸ë”©(dynamic)

> ë³¼ë¥¨ì€ ìŠ¤í† ë¦¬ì§€ë¥¼ ë§ˆìš´íŠ¸í•´ì„œ ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.
- ë§ˆì¹˜ ìê¸° ìì‹ ì˜ ì €ì¥ ê³µê°„ì„ ì´ìš©í•˜ëŠ” ê²ƒ ì²˜ëŸ¼

---

# 4ï¸âƒ£ ì„ì‹œ ë³¼ë¥¨
ğŸ”¹ì™¸ë¶€ ìŠ¤í† ë¦¬ì§€ ë°±ì—”ë“œë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì— ìœ„ì¹˜í•œ ë³¼ë¥¨ ë¦¬ì†ŒìŠ¤
ğŸ”¹íŒŒë“œ í˜¹ì€ ë…¸ë“œ ì‚­ì œ ì‹œì ì— ì‚­ì œë˜ëŠ” íŠ¹ì„±ì„ ê°€ì§(ë§ ê·¸ëŒ€ë¡œ ì„ì‹œë¡œ ì¡´ì¬)
ğŸ”¹ë¹ ë¥¸ ìƒì„±/ì‚­ì œê°€ ê°€ëŠ¥í•˜ë©°, ë¡œì»¬ ë…¸ë“œ ë””ìŠ¤í¬(or ë©”ëª¨ë¦¬)ë¥¼ ì‚¬ìš©

![](https://velog.velcdn.com/images/alstjr971/post/c9a634ff-28e6-4f31-8dc1-5bc53c0799af/image.png)

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: emptydir-demo
spec:
  containers:
    - name: writer
      image: busybox
      command: ["sh", "-c", "echo hello > /data/msg.txt; sleep 3600"]
      volumeMounts:
        - name: workdir
          mountPath: /data
  volumes:
    - name: workdir
      emptyDir: {}

```


### âœ³ï¸hostPath
**íŒŒë“œ ìƒì„± ì‹œì ì— ì§€ì •ëœ í˜¸ìŠ¤íŠ¸ ê²½ë¡œì™€ ë§ˆìš´íŠ¸ ë˜ì–´ íŒŒë“œ ì‚­ì œ ì‹œ ë³¼ë¥¨ ë§ˆìš´íŠ¸ë§Œ í•´ì œë˜ëŠ” ë³¼ë¥¨**
- ìƒì„± ìœ„ì¹˜ : í˜¸ìŠ¤íŠ¸ íŒŒì¼ ì‹œìŠ¤í…œì˜ ì§€ì • ê²½ë¡œ
- í˜¸ìŠ¤íŠ¸ ë¡œê·¸, ì„¤ì • íŒŒì¼ ê³µìœ ì˜ ëª©ì ìœ¼ë¡œ ì£¼ë¡œ ì‚¬ìš©

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: hostpath-demo
spec:
  containers:
    - name: reader
      image: busybox
      command: ["sh", "-c", "sleep 3600"]
      volumeMounts:
        - name: host-vol
          mountPath: /mnt/hostpath
  volumes:
    - name: host-vol
      hostPath:
        path: /tmp/hostpath-demo
        type: DirectoryOrCreate

```

### âœ³ï¸ConfigMap
- ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • ë°ì´í„°ë¥¼ íŒŒì¼ í˜•íƒœë¡œ íŒŒë“œ ë‚´ ì£¼ì…
- ì§€ì •ëœ ë§ˆìš´íŠ¸ ê²½ë¡œ ì•„ë˜ Key ë‹¹ íŒŒì¼ì´ ìƒì„±
- ì„¤ì • ì—…ë°ì´íŠ¸ ì‹œ, íŒŒë“œ ì¬ì‹œì‘ í•„ìš”
- í‰ë¬¸ í˜•íƒœë¡œ ì €ì¥ë˜ê¸° ë•Œë¬¸ì— ë¯¼ê° ì •ë³´ëŠ” ì €ì¥í•˜ë©´ ìœ„í—˜

ConfigMapì„ ì ìš©í•˜ë ¤ë©´ íŒŒë“œë¥¼ ì¬ì‹œì‘í•´ ìƒˆë¡œìš´ ConfigMapì´ ì ìš©ë˜ë„ë¡ í•´ì•¼ í•œë‹¤.

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  app.conf: |
    log_level=info
    theme=dark
---
apiVersion: v1
kind: Pod
metadata:
  name: configmap-demo
spec:
  containers:
    - name: app
      image: busybox
      command: ["sh", "-c", "sleep 3600"]
      volumeMounts:
        - name: config-vol
          mountPath: /etc/config
  volumes:
    - name: config-vol
      configMap:
        name: app-config

```

### âœ³ï¸Secret
- ë¯¼ê° ì •ë³´ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ ë¦¬ì†ŒìŠ¤
- ë§ˆìš´íŠ¸ ê²½ë¡œ ë‚´ Key ë‹¹ íŒŒì¼ì´ ìƒì„±ë˜ë©°, `defaultMode`ë¡œ ê¶Œí•œ ì¡°ì ˆ ê°€ëŠ¥
- etcdì— base64 í˜•íƒœë¡œ ì €ì¥ë˜ë¯€ë¡œ, etcdì— ëŒ€í•œ ì ‘ê·¼ ì œì–´ ë“±ì˜ ì¶”ê°€ ë³´ì•ˆ ì¡°ì¹˜ê°€ í•„ìš”

> ConfigMapì´ í‰ë¬¸ìœ¼ë¡œ ì €ì¥ë˜ê¸° ë•Œë¬¸ì— ë³´ì•ˆì  ìš”ì†Œë¥¼ ê°–ì¶”ê³  ì €ì¥ë  ê²ƒ ê°™ì§€ë§Œ, ë‹¨ìˆœíˆ base64ë¡œ 'ì¸ì½”ë”©'ë˜ì–´ ì €ì¥ëœë‹¤.
ë”°ë¼ì„œ etcd ìì²´ë¥¼ í†µì§¸ë¡œ ì•”í˜¸í™” í•œë‹¤ê±°ë‚˜ etcd ì— ì ‘ê·¼ì„ RBACìœ¼ë¡œ ì œì–´í•˜ëŠ” ë“±ì˜ ì¶”ê°€ì ì¸ ì¡°ì¹˜ê°€ í•„ìš”í•˜ë‹¤.

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: secret-demo
spec:
  containers:
    - name: app
      image: busybox
      command: ["sh", "-c", "sleep 3600"]
      volumeMounts:
        - name: secret-vol
          mountPath: /etc/secret
          readOnly: true
  volumes:
    - name: secret-vol
      secret:
        secretName: db-creds
        defaultMode: 0640

```

---

# 5ï¸âƒ£ PV
- í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ ë¬¼ë¦¬/ë…¼ë¦¬ ìŠ¤í† ë¦¬ì§€ë¥¼ ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ë¡œ ì¶”ìƒí™”í•œ ê²ƒ
- ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ì™¸ë¶€ì— ìœ„ì¹˜í•œ ë¦¬ì†ŒìŠ¤ í˜•íƒœ
- PVC ìš”ì²­ ì‚¬í•­ì— ë§ëŠ” ê·œê²©ì˜ PVë¥¼ ì§ì ‘ ìƒì„±í•˜ê±´, `StorageClass`ì— ì˜í•´ ìë™ìœ¼ë¡œ ìƒì„±ë  ìˆ˜ ìˆë‹¤.
- PV ë¦¬ì†ŒìŠ¤ê°€ ì‚­ì œë˜ê±°ë‚˜ ReclaimPolicyì— ë”°ë¼ ì²˜ë¦¬ë  ë•Œ ê¹Œì§€ ìœ ì§€
![](https://velog.velcdn.com/images/alstjr971/post/b3d3ddb2-4100-44d3-b83e-64b30e8bb653/image.png)

**ì„ì‹œ ë³¼ë¥¨ì´ ì•„ë‹ˆë¼ Persistence ë³¼ë¥¨ì´ê¸° ë•Œë¬¸ì— ì§ì§‘ ì§€ìš°ê±°ë‚˜ ReclaimPolicyë¡œ ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€ ì •ì˜í•˜ì§€ ì•Šìœ¼ë©´ ê³„ì† ì˜ì†ì ìœ¼ë¡œ ìœ ì§€ëœë‹¤.**

```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: demo-pv
spec:
  capacity:
    storage: 5Gi
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  storageClassName: slow
  hostPath:
    path: /mnt/data/demo
    type: DirectoryOrCreate

```

### âœ³ï¸PV ì£¼ìš” ìŠ¤í™ í•„ë“œ
1. capacity.storage : ìŠ¤í† ë¦¬ì§€ê°€ ì œê³µí•  ìš©ëŸ‰(10Gi, 100Gi, etc)

2. accessMode : ë³¼ë¥¨ ì ‘ê·¼ ëª¨ë“œ
   - ReadWriteOnce : í•˜ë‚˜ì˜ ë…¸ë“œì—ì„œë§Œ RW
   - ReadOnlyMany : ì—¬ëŸ¬ ë…¸ë“œì—ì„œ RO
   - ReadWriteMany : ì—¬ëŸ¬ ë…¸ë“œì—ì„œ RW

3. persistenceVolumeReclaimPolicy : PVC ì‚­ì œ ì‹œ PV ì˜ ì²˜ë¦¬ ë°©í–¥
   - Retain : ë³¼ë¥¨ê³¼ ë°ì´í„° ë³´ì¡´ # ê·¸ëƒ¥ ë‘˜ê±´ì§€
   - Delete : ë°±ì—”ë“œ ë³¼ë¥¨ ì‚­ì œ # í†µì±„ë¡œ ë‚ ë¦´ê±´ì§€
   - Recycle : ì‚¬ìš© X
4. storageClassName : PVë¥¼ ë°”ì¸ë”©í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì´ë¦„
   - PVCì™€ PVë¥¼ ë°”ì¸ë”©í•  ë•Œ ì´ë¦„ì´ ê°™ì•„ì•¼ ë°”ì¸ë”© í•  ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ storageClassì—ì„œ ì–´ë–¤ `driver`ë¥¼ ì‚¬ìš©í•  ê²ƒì¸ê°€ í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì´ë¦„ì„ ì§€ì •í•´ì•¼ í•œë‹¤.

> PVCëŠ” ë³¼ë¥¨ì„ ìš”ì²­í•˜ëŠ” ì²­êµ¬ì„œì˜ ì—­í• ì´ê³ , PVê°€ ì‹¤ì œ ë³¼ë¥¨ì´ë‹¤. 
PVëŠ” ì‹¤ì œ ë¬¼ë¦¬ ìŠ¤í† ë¦¬ì§€ë¥¼ ë§ˆìš´íŠ¸í•´ ì œê³µëœë‹¤.

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: demo-pvc
spec:
  storageClassName: slow
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
---
apiVersion: v1
kind: Pod
metadata:
  name: pv-test-pod
spec:
  containers:
    - name: app
      image: busybox
      command: ["sh", "-c", "sleep 3600"]
      volumeMounts:
        - name: data
          mountPath: /usr/share/data
  volumes:
    - name: data
      persistentVolumeClaim:
        claimName: demo-pvc

```

---
# 6ï¸âƒ£ë³¼ë¥¨ ìˆ˜ëª… ì£¼ê¸° ê´€ë¦¬

**ì „ì²´ì ì¸ íë¦„**

1. íŒŒë“œê°€ `PVC`ë¥¼ ìƒì„±í•˜ì—¬ ì„ ì–¸ í›„, ë¯¸ë¦¬ ë§Œë“¤ì–´ì§„ PVë‚˜ StorageClassë¥¼ í†µí•´ PVê°€ ì¤€ë¹„ëœë‹¤.
   - PVì—ëŠ” Volume Mode, Access Mode, Storage Type ë“±ì´ ê²°ì •
2. ì¤€ë¹„ëœ PVëŠ” PVCì™€ ì—°ê²°ë˜ì–´ íŒŒë“œì— ë§ˆìš´íŠ¸ë˜ê³ , ì ‘ê·¼ ëª¨ë“œê°€ ì ìš©ëœë‹¤.
3. PVCê°€ ì‚­ì œë  ë•Œ PVëŠ” ì„¤ì •ëœ reclaimPolicyì— ë”°ë¼ ì‚­ì œë˜ê±°ë‚˜, ë³´ì¡´ëœë‹¤.(ì¬ì‚¬ìš©ì€ ì—†ì–´ì§)

![](https://velog.velcdn.com/images/alstjr971/post/0784c49c-7227-4a53-b058-220c1592b2d9/image.png)


---

# 7ï¸âƒ£ ë³¼ë¥¨ í”„ë¡œë¹„ì €ë‹
## âœ³ï¸PVC(Persistence Volume Claim)
- íŒŒë“œê°€ í•„ìš”ë¡œí•˜ëŠ” ìŠ¤í† ë¦¬ì§€ ìš©ëŸ‰ì´ë‚˜ ì ‘ê·¼ ëª¨ë“œ ë“±ì„ ì„ ì–¸í•˜ëŠ” ë¦¬ì†ŒìŠ¤
- PVC ìƒì„± ì‹œ, ë°”ì¸ë”© ë  PVë¥¼ ì°¾ê±°ë‚˜ ìƒˆë¡œ ìƒì„±í•˜ë„ë¡ í´ëŸ¬ìŠ¤í„°ê°€ ë™ì‘í•¨

`PVC ì£¼ìš” ìŠ¤í™ í•„ë“œ`

1. storageClassName : ì–´ë–¤ storageClass ì •ì±…ìœ¼ë¡œ ë³¼ë¥¨ì„ í”„ë¡œë¹„ì €ë‹í• ì§€ ì§€ì •

2. accessMode : ì ‘ê·¼ ëª¨ë“œ ì§€ì •
   - PV.spec.accessModeì™€ ê°’ì´ ë°˜ë“œì‹œ ì¼ì¹˜í•´ì•¼ ë°”ì¸ë”© ê°€ëŠ¥
  
3. resources.requests.storage : ìš”ì²­ ìš©ëŸ‰
   - PV.capacity ê°’ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ì•„ì•¼ ë°”ì¸ë”© ê°€ëŠ¥
   - ë‹¹ì—°íˆ ë³´ìœ í•œ PV ìš©ëŸ‰ì´ 100Gì¸ë° PVCë¡œ 120G ìš”ì²­í•˜ë©´ ë°”ì¸ë”© ë¶ˆê°€
  
4. selector : ë¯¸ë¦¬ ë§Œë“  PVì— ë¶™ì¸ ë ˆì´ë¸”ë¡œ ë°”ì¸ë”©ì„ ì œì•½
   - Static Provisioning ì „ìš©ìœ¼ë¡œ ì§€ì •
   
```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: demo-pvc
spec:
  storageClassName: slow
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi

```
  
## âœ³ï¸ìŠ¤í† ë¦¬ì§€(ë³¼ë¥¨) ë°”ì¸ë”©
** PVCì™€ PVë¥¼ ì—°ê²°í•´ì£¼ëŠ” ê³¼ì •**

`ë°”ì¸ë”© ì¡°ê±´`

1. ë™ì  í”„ë¡œë¹„ì €ë‹ì˜ ê²½ìš°, StorageClass ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ìë™ìœ¼ë¡œ PVCì— ë§ëŠ” PVë¥¼ ìƒì„±í•˜ë¯€ë¡œ ì¦‰ì‹œ ë°”ì¸ë”© ëœë‹¤.

2. PVC.spec.storageClassName == PV.spec.storageClassName # PVCì˜ ìŠ¤í† ë¦¬ì§€ í´ë˜ìŠ¤ ì´ë¦„ê³¼ PVì— ì •ì˜í•œ í´ë˜ìŠ¤ ì´ë¦„ì´ ê°™ì•„ì•¼ í•¨

3. PVC.spec.accessModes âŠ† PV.spec.accessModes # PVCì— ì ‘ê·¼ ëª¨ë“œëŠ” PVì— ì •ì˜ëœ ì ‘ê·¼ ëª¨ë“œë³´ë‹¤ ì•„ë« ë‹¨ê³„ì—¬ì•¼ í•¨

4. PVC.resources.requests.storage â‰¤ PV.capacity.storage # ìœ„ì—ì„œ ì„¤ëª…í•¨

**Static ë°”ì¸ë”©**
- ê´€ë¦¬ìê°€ ë¯¸ë¦¬ ë§Œë“  PVì— ë ˆì´ë¸”ì„ ë¶€ì—¬í•œ í›„, PVC.selectorë¡œ ë§¤ì¹­í•˜ëŠ” ë°”ì¸ë”© ë°©ì‹

```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv-static
  labels:
    tier: gold
spec:
  capacity:
    storage: 5Gi
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  storageClassName: ""
  hostPath:
    path: /mnt/static
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: pvc-static
spec:
  selector:
    matchLabels:
      tier: gold
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi

```

**Dynamic ë°”ì¸ë”©**
- PVC.storageClassName ì§€ì • ì‹œ, SC í”„ë¡œë¹„ì €ë„ˆê°€ PVë¥¼ ìƒì„± -> ìë™ ë°”ì¸ë”©


```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv-static
  labels:
    tier: gold
spec:
  capacity:
    storage: 5Gi
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  storageClassName: ""
  hostPath:
    path: /mnt/static
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: pvc-static
spec:
  selector:
    matchLabels:
      tier: gold
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi

```
## âœ³ï¸StorageClass
**ë™ì  í”„ë¡œë¹„ì €ë‹ ì‹œ ë³¼ë¥¨ ìƒì„± ì •ì±…ì„ ì •ì˜í•˜ëŠ” í…œí”Œë¦¿**

- provisioner(CSI ë“œë¼ì´ë²„), parameters, recalimPolicy ë“±ì„ ì„ ì–¸

`ì£¼ìš” ìŠ¤í™ í•„ë“œ`

1. provisioner: ì‹¤ì œ ë³¼ë¥¨ì„ ìƒì„±í•  CSI ë“œë¼ì´ë²„ ì‹ë³„ì

2. parameters: ë“œë¼ì´ë²„ë³„ ì˜µì…˜ (ë””ìŠ¤í¬ íƒ€ì…, íŒŒì¼ì‹œìŠ¤í…œ, IOPS ë“±)

3. reclaimPolicy: PVC ì‚­ì œ ì‹œ PV ì‚­ì œ(Delete) ë˜ëŠ” ë³´ì¡´(Retain)

4. volumeBindingMode: PV ë°”ì¸ë”© ëª¨ë“œë¥¼ ê²°ì •
   - Immediate: PVC ìƒì„± ì‹œ ì¦‰ì‹œ ë°”ì¸ë”©
   - WaitForFirstConsumer: íŒŒë“œ ìŠ¤ì¼€ì¤„ ì´í›„ ë°”ì¸ë”© 
   
```yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: fast-ssd
provisioner: kubernetes.io/aws-ebs
parameters:
  type: gp3
  fsType: ext4
reclaimPolicy: Delete
volumeBindingMode: WaitForFirstConsumer
allowVolumeExpansion: true
```
   
---

# 8ï¸âƒ£ ë³¼ë¥¨ ì‚­ì œ ê´€ë¦¬

### âœ³ï¸Reclaim Policy

-  PVC ì‚­ì œ ì‹œ, PV ë° ë°±ì¸ë“œ ìŠ¤í† ë¦¬ì§€ ìì›ì— ëŒ€í•´ ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€ ê²°ì •í•˜ëŠ” ì˜µì…˜
   - persistentVolumeReclaimPolicy: ì§ì ‘ ìƒì„±í•œ PVì˜ ê²½ìš°, í•´ë‹¹ ì˜µì…˜ìœ¼ë¡œ ì ìš©
   - reclaimPolicy: storageClassì˜ ê²½ìš°, í•´ë‹¹ ì˜µì…˜ìœ¼ë¡œ ì ìš©
   
`ì£¼ìš” ì˜µì…˜`

1. Delete: ê¸°ë³¸ ì˜µì…˜ìœ¼ë¡œ, PV ì˜¤ë¸Œì íŠ¸ì™€ ë°±ì—”ë“œ ë³¼ë¥¨ ëª¨ë‘ ì‚­ì œ
2. Retain: PV ì˜¤ë¸Œì íŠ¸ë¥¼ Released ìƒíƒœë¡œ ì „í™˜ í›„, ë°±ì—”ë“œ ë³¼ë¥¨ ë³´ì¡´
3. Recycle: ê°„ë‹¨í•œ í¬ë§· í›„, PV ì¬ì‚¬ìš©(ë” ì´ìƒ ê¶Œì¥ë˜ì§€ ì•ŠëŠ” êµ¬í˜• ì˜µì…˜)


---

# 9ï¸âƒ£ ë³¼ë¥¨ ìŠ¤ëƒ…ìƒ·
**VolumeSnapshot CRDë¥¼ í†µí•´ PVCì˜ ì‹œì  ì €ì¥ë³¸ì„ ìƒì„± ë° ê´€ë¦¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤**

> VolumeSnapshotClass â†’ VolumeSnapshot â†’ VolumeSnapshotContent ìˆœìœ¼ë¡œ ì—°ë™

`ì£¼ìš” ìŠ¤í™ í•„ë“œ(VolumeSnapshotClass)`

1. spec.driver: CSI ë“œë¼ì´ë²„ ì‹ë³„ì
2. spec.deletionPolicy: ìŠ¤ëƒ…ìƒ· ì‚­ì œ ì •ì±…(Delete í˜¹ì€ Retain)
3. spec.source.persistentVolumeClaimName: ìŠ¤ëƒ…ìƒ· ëŒ€ìƒ PVC

`ì£¼ìš” ìŠ¤í™ í•„ë“œ(VolumeSnapshot)`

1. spec.volumeSnapshotClassName: ìŠ¤ëƒ…ìƒ· í´ë˜ìŠ¤ëª…
2. spec.source.persistentVolumeClaimName: ìŠ¤ëƒ…ìƒ· ëŒ€ìƒ PVC

```yaml
apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshotClass
metadata:
  name: csi-snap-class
driver: rancher.io/local-path
deletionPolicy: Delete
---
apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshot
metadata:
  name: pvc-snap-demo
spec:
  volumeSnapshotClassName: csi-snap-class
  source:
    persistentVolumeClaimName: pvc-local-demo

```

---

# ğŸ”Ÿ CSI(Container Storage Interface)

**ë²¤ë” ë° ì»¤ë®¤ë‹ˆí‹°ê°€ ë…ë¦½ì ìœ¼ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë³¼ë¥¨ í”ŒëŸ¬ê·¸ì¸ì„ ê°œë°œí•  ë•Œ ë°°í¬í•˜ë„ë¡ ê·œê²©í™”ëœ ì¸í„°í˜ì´ìŠ¤**

- ì¿ ë²„ë„¤í‹°ìŠ¤ ìì²´ ë³¼ë¥¨ í”ŒëŸ¬ê·¸ë¦¼ íŒ¨ëŸ¬ë‹¤ì„ì—ì„œ ë¶„ë¦¬
   - ìì²´ íŒ¨ëŸ¬ë‹¤ì„ì´ ìˆëŠ”ì§€ë„ ëª°ëë‹¤. ê·¸ëƒ¥ ê·¸ëŸ°ê²Œ ìˆì—ˆêµ¬ë‚˜ í•˜ì.


![](https://velog.velcdn.com/images/alstjr971/post/621b1b7d-f902-463f-9bf3-69063c2144b3/image.png)

### âœ³ï¸CSI ì£¼ìš” ì»´í¬ë„ŒíŠ¸

**1. CSI ì»¨íŠ¸ë¡¤ëŸ¬**(ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ ì»´í¬ë„ŒíŠ¸)
- ì¿ ë²„ë„¤í‹°ìŠ¤ ì»¨í…Œì´ë„ˆì—ì„œ ì‚¬ìš©í•  ë³¼ë¥¨ì„ ìŠ¤í† ë¦¬ì§€ ì„œë²„ì—ì„œ ìƒì„± ë° ì‚­ì œí•˜ëŠ” ê²ƒì„ ë‹´ë‹¹

**2. ë…¸ë“œ ì„œë²„**(ë…¸ë“œ í”Œë ˆì¸ ì»´í¬ë„ŒíŠ¸)
- íŒŒë“œê°€ ë°°í¬ë  ë…¸ë“œì—ì„œ ìŠ¤í† ë¦¬ì§€ ë³¼ë¥¨ì— ë§ˆìš´íŠ¸í•  ìˆ˜ ìˆëŠ” í™˜ê²½ì„ ìƒì„±

**3. Sidecar ì»¨í…Œì´ë„ˆ**
- í”„ë¡œë¹„ì €ë„ˆ : í´ëŸ¬ìŠ¤í„°ì— PVCê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ ëª¨ë‹ˆí„°ë§ í›„ PVCê°€ ìƒì„±ë˜ë©´ PVë¥¼ ìƒì„±
- Attatcher : íŒŒë“œê°€ PVCë¥¼ ì‚¬ìš©í•  ë•Œ, í•´ë‹¹ íŒŒë“œì—ì„œ PVë¥¼ ë§ˆìš´íŠ¸í•˜ëŠ” ê²ƒì„ ë‹´ë‹¹


![](https://velog.velcdn.com/images/alstjr971/post/e69ff7ed-65d8-47d5-8326-777b9a184e44/image.png)
